<h1 class="unnumbered" id="preface">Preface</h1>
<p>This book is a humble attempt to capture every piece of information
given by Salvatore Sanfilippo—aka <a
href="https://github.com/antirez">antirez</a>—in his C course presented
on YouTube.</p>
<p>Each chapter is written following each lesson and, if needed,
integrated with personal consideration. Each snippet is written and
tested by me and may vary from what is stated in the lessons.</p>
<h1 class="unnumbered" id="introduction">Introduction</h1>
<h2 class="unnumbered" id="the-c-language-as-an-idea-of-computation">The
C language, as an idea of computation</h2>
<p>C was invented in <a
href="https://it.wikipedia.org/wiki/Bell_Laboratories">Bell Labs</a>
when <a href="https://it.wikipedia.org/wiki/Ken_Thompson">Ken
Thompson</a> was working on Unix. Following the idea that a good
operating system should have had a high level compiled language. After
abandoning the first attempt on creating a compiler for <a
href="https://it.wikipedia.org/wiki/Fortran"><code>Fortran</code></a>, a
smaller new language was created and named <a
href="https://en.wikipedia.org/wiki/B_(programming_language)"><code>B</code></a>.
<code>B</code> better fitted <a
href="https://en.wikipedia.org/wiki/PDP-11">P2P11</a> but was not enough
to port Unix from Assembly. <a
href="https://en.wikipedia.org/wiki/C_(programming_language)"><code>C</code></a>
was created with a set of feature that were missing in <code>B</code>
and was a much better fit for the Unix system.</p>
<p><code>C</code> was a better language mainly because its multiple
distinct types:</p>
<ul class="incremental">
<li>pointers;</li>
<li>integer;</li>
<li>floating point numbers: float;</li>
</ul>
<p>In that sense, <code>C</code> language can be visualized as
<code>B</code> with types where all types can also be imagined as
integers since pointers—in very simple terms—are integers and so are
structures. In fact, structures are a set of integers representing
offsets of each field position in memory and values of the very same
fields. This simplicity can be considered the strength of the language
as it can be easily picked up by new developers, layered to build a
powerful abstraction and, with that, imagine in simple terms complex
topics and algorithms.</p>
<h2 class="unnumbered" id="the-cli-as-a-lifestyle">The CLI, as a
lifestyle</h2>
<p>To understand every aspect of <code>C</code>, many tools will be used
and all examples will refer to <a
href="https://en.wikipedia.org/wiki/Command-line_interface">CLI</a>
commands. I will be using <a href="https://neovim.io/">Neovim</a> as
text editor and operate on a Linux machine. The output of commands and
all examples may differ from machine to machine but the concepts will
remain valid.</p>
<p>I strongly believe that the best way to develop software is by using
<code>CLI</code> and lightweight text editors such as
<code>neovim</code> or <code>vim</code>. Whenever is possible I will
avoid using browsers to search for documentation by preferring usage of
<code>man</code> directly into the terminal. This will keep low the
friction and avoid the necessity to leave the home row of my
keyboard.</p>
<h1 id="anatomy-of-a-c-program">Anatomy of a C program</h1>
<h2 id="execute-a-c-program">Execute a C program</h2>
<p><code>C</code> is a compiled language, this means you cannot execute
a file containing the main function. It requires to be compiled.</p>
<p>You can use: <code>cc</code> to compile a <code>C</code> program.
<code>cc</code> is a Unix command that let you easily communicate with
the compiler. You can use: <code>cc --version</code> to check what
compiler does it use.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cc <span class="ex">--version</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cc</span> <span class="er">(</span><span class="ex">GCC</span><span class="kw">)</span> <span class="ex">14.2.1</span> 20240912 <span class="er">(</span><span class="ex">Red</span> Hat 14.2.1-3<span class="kw">)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Copyright</span> <span class="er">(</span><span class="ex">C</span><span class="kw">)</span> <span class="ex">2024</span> Free Software Foundation, Inc.</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> is free software<span class="kw">;</span> <span class="ex">see</span> the source for copying conditions.  There is NO</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">warranty</span><span class="kw">;</span> <span class="ex">not</span> even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></code></pre></div>
<p>Let’s consider the following simple <code>C</code> program contained
in a file named—for instance—<code>hello_world.c</code> (how
original):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;Hello World</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>You can use: <code>cc hello_world.c</code> to compile it to an
executable program.</p>
<p>The compiler generates an executable binary file named:
<code>a.out</code>. This file is executable and runs your program. You
can use: <code>file a.out</code> to check information about the
generated file.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> file <span class="ex">a.out</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./a.out:</span> ELF 64-bit LSB executable, x86-64, version 1 <span class="er">(</span><span class="ex">SYSV</span><span class="kw">)</span><span class="ex">,</span> dynamically linked, <span class="dt">\</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>interpreter /lib64/ld-linux-x86-64.so.2, <span class="dt">\</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>BuildID<span class="pp">[</span><span class="ss">sha1</span><span class="pp">]</span>=d589730d718a032a35f848fe8d280063a6cee18c, <span class="dt">\</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>for GNU/Linux 3.2.0, not stripped</span></code></pre></div>
<p>If you want to check the content of the generated binary file, you
can use: <code>hexdump -C a.out</code>.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> hexdump <span class="ex">-C</span> a.out</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">00000000</span>  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  <span class="kw">|</span><span class="ex">.ELF............</span><span class="kw">|</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">00000010</span>  02 00 3e 00 01 00 00 00  40 10 40 00 00 00 00 00  <span class="kw">|</span><span class="ex">..</span><span class="op">&gt;</span>.....@.@.....<span class="kw">|</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">00000020</span>  40 00 00 00 00 00 00 00  f0 38 00 00 00 00 00 00  <span class="kw">|</span><span class="ex">@........8......</span><span class="kw">|</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">00000030</span>  00 00 00 00 40 00 38 00  0d 00 40 00 20 00 1f 00  <span class="kw">|</span><span class="ex">....@.8...@.</span> ...<span class="kw">|</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">00000040</span>  06 00 00 00 04 00 00 00  40 00 00 00 00 00 00 00  <span class="kw">|</span><span class="ex">........@.......</span><span class="kw">|</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">00000050</span>  40 00 40 00 00 00 00 00  40 00 40 00 00 00 00 00  <span class="kw">|</span><span class="ex">@.@.....@.@.....</span><span class="kw">|</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ex">00000060</span>  d8 02 00 00 00 00 00 00  d8 02 00 00 00 00 00 00  <span class="kw">|</span><span class="ex">................</span><span class="kw">|</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[...]</span></span></code></pre></div>
<p>You can also generate <a
href="https://en.wikipedia.org/wiki/Assembly_language">Assembly</a> code
using: <code>cc -S hello_world.c</code> if the compiler supports this
feature.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cat <span class="ex">hello_world.s</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.file</span>   <span class="st">&quot;hello_world.c&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.text</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.section</span>    .rodata</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">.LC0:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.string</span> <span class="st">&quot;Hello World&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.text</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.globl</span>  main</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.type</span>   main, @function</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="ex">main:</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ex">.LFB0:</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.cfi_startproc</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">pushq</span>   %rbp</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.cfi_def_cfa_offset</span> 16</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.cfi_offset</span> 6, <span class="at">-16</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">movq</span>    %rsp, %rbp</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.cfi_def_cfa_register</span> 6</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">movl</span>    $.LC0, %edi</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">call</span>    puts</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">movl</span>    <span class="va">$0</span>, %eax</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">popq</span>    %rbp</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.cfi_def_cfa</span> 7, 8</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ret</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.cfi_endproc</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="ex">.LFE0:</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.size</span>   main, .-main</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.ident</span>  <span class="st">&quot;GCC: (GNU) 14.2.1 20240912 (Red Hat 14.2.1-3)&quot;</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="ex">.section</span>    .note.GNU-stack,<span class="st">&quot;&quot;</span>,@progbits</span></code></pre></div>
<p>With a given compiler, you can tweak many compilation aspects. For
instance, <code>cc -O2 hello_world.c</code> tells the compiler to
optimize the generated executable. A more optimized version of the
executable is also slower to be generated and, if that does not make
much sense for small programs, it can output a much better version of
the program when a high enough level of complexity has been reached.</p>
<p>With <a
href="https://en.wikipedia.org/wiki/GNU_Compiler_Collection">GCC</a>
compiler, you can see that our simple program make use of
<code>puts</code> <a
href="https://en.wikipedia.org/wiki/System_call">syscall</a>, however,
this depends on the compiler itself and, often, with different
compilers, the line: <code>printf("Hello World\n");</code> is compiled
using <code>printf</code> syscall instead.</p>
<p>Using <code>-O2</code> flag can make the compiler use
<code>puts</code> as this syscall is faster than <code>printf</code>.
This is a simple, yet meaningful, example but in such a small program it
does make no difference in terms of execution speed. The compiler is
very good at improving written programs if given enough time. While
developing, though, a low compilation time is often preferred.</p>
<blockquote>
<p>You can check the standard C library from the terminal using
<code>man</code> or <code>--help</code> flags. For example, you can use
<code>man 3 puts</code> or <code>man 3 printf</code> to check
documentation of both syscalls (3 makes sure to output the C library
description).</p>
</blockquote>
<h2 id="include-other-source-code">Include other source code</h2>
<p>In the very first line of our simple program, you can see a <a
href="https://en.wikipedia.org/wiki/Preprocessor">preprocessor</a> <a
href="https://en.wikipedia.org/wiki/Directive_(programming)">directive</a>.
This line simply tells to the compiler that a file need to be included
into the program. The compiler, before the compilation, take the content
of the file and <em>paste</em> it at the location. In this case,
<code>&lt;stdio.h&gt;</code> declares the prototype of
<code>printf</code> function so to instruct the compiler on how to
execute that specific call. To prove this point, you can remove the
first line and replace it with:
<code>int printf(const char *restrict format, ...);</code> which is the
prototype of the function we want to call.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> printf<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span><span class="dt">restrict</span> format<span class="op">,</span> <span class="op">...);</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;Hello World</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><code>#include</code> can also be used to include <code>C</code>
files. In fact, you can move a single line to a different file and than
compile a program that includes the file on the line you want it to be
replaced.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#include </span><span class="im">&quot;file.c&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The generated assembly or machine code will be equivalent.</p>
